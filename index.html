<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&display=swap" rel="stylesheet">
    <link href="./root_style.css" rel="stylesheet">
    <script>
        function subImage(){
            let cone = document.getElementById("cone")
            let width = cone.offsetWidth;
            let height = cone.offsetHeight;
            cone.width = width
            cone.height = height
            return [width, height]
        }


        let ctx;
        let threshold = 150;
        let forwards = true;
        var img1 = new Image();

        let previousTimestamp = performance.now();

        function animate(timestamp){
            let timeElapsed = timestamp - previousTimestamp;
            previousTimestamp = timestamp;
            let [coneWidth, coneHeight] = subImage()
            if(coneWidth < coneHeight){
                let ratio = coneWidth/coneHeight
                ctx.drawImage(img1, 0, 0, img1.width * ratio, img1.height, 0, 0, coneWidth, coneHeight)
            }else{
                let ratio = coneHeight/coneWidth
                ctx.drawImage(img1, 0, 0, img1.width, img1.height * ratio, 0, 0, coneWidth, coneHeight)
            }
            // this is silly, can we not pass the image data directly
            // without writting to the canvas first
            const imageData = ctx.getImageData(0, 0, coneWidth, coneHeight);
            const data = imageData.data;
            for (var i = 0; i < data.length; i += 4) {
                // 0 = red, 1 = green, 2 = blue
                for(var color = 0; color < 3; color +=1){
                    if(data[i+color] < threshold){
                        data[i+color] = 100;
                    }else{
                        data[i+color] = 145;
                    }
                }
            }
            ctx.putImageData(imageData, 0, 0);

            let thresholdChange = timeElapsed / 100; 
            let changeDirection = 1;
            if(!forwards){
                changeDirection = -1;
            }

            threshold += changeDirection * thresholdChange;

            if(threshold > 240){
                forwards = false;
            }
            if(threshold < 150){
                forwards = true;
            }
            window.requestAnimationFrame(animate)
        }

        window.onload = () => {
            var canvas = document.getElementById('cone');
            if (canvas.getContext) {
                ctx = canvas.getContext('2d');
                img1.src = './cone.png';
                img1.onload = function () {
                    window.requestAnimationFrame(animate)
                };
            }
        }
    </script>
</head>

<body>
    <!-- width="657px" height="657px" -->
    <canvas id="cone"></canvas>
    <div id="left">
        <div id="title">
            <p>plgangplgangplangplgang</p>
            <h1>PLGANG</h1>
            <p>plgangplgangplangplgang</p>
        </div>
        <ul>
            <li><a href="./PLS/PL02/index.html">PL02 - 80s</a></li>
            <li><a href="./PLS/PL03/index.html">PL03 - Jungle / DnB</a></li>
        </ul>
    </div>

</body>

</html>